<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Smart Meal Planner</title>
    <!-- 
      SMART MEAL PLANNER
      ==================
      A comprehensive meal planning application that helps users discover recipes
      across all meal types and cooking methods. Features include:
      
      - Meal categories: Breakfast, Lunch, Dinner, Desserts
      - Multiple cooking methods: Microwave, Stove, Air Fryer, Oven, Fridge/Freezer
      - Ingredient-based recipe filtering with visual chips
      - AI-powered recipe generation for custom meals
      - Ingredient requirements display for each recipe
      - Responsive design with modern UI
      - Local storage for generated recipes
    -->
    <style>
      /* CSS CUSTOM PROPERTIES - Design system variables */
      :root {
        --bg: #0f172a;           /* Main background color */
        --panel: #111827;        /* Card/panel background */
        --panel-2: #0b1220;      /* Secondary panel background */
        --text: #e5e7eb;         /* Primary text color */
        --muted: #9ca3af;        /* Secondary/muted text */
        --brand: #22c55e;        /* Primary brand color (green) */
        --brand-2: #16a34a;      /* Darker brand color for gradients */
        --chip: #1f2937;         /* Chip/tag background */
        --card: #0b1220;         /* Card background */
        --border: #1f2937;       /* Border color */
        --danger: #ef4444;       /* Error/danger color */
      }

      /* RESET AND BASE STYLES */
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        /* Dark gradient background for modern look */
        background: linear-gradient(180deg, var(--panel-2), var(--bg));
        color: var(--text);
        /* System font stack for optimal performance and consistency */
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* LAYOUT CONTAINER */
      .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 24px 16px 48px;
      }

      /* HERO SECTION - Main call-to-action area */
      header { margin: 26px 0 10px; }
      .hero {
        /* Radial gradient for visual depth and modern appearance */
        background: radial-gradient(900px 300px at 20% -20%, #1c2b49 0%, rgba(17,24,39,0) 60%), var(--panel);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 28px 20px;
        text-align: center;
      }
      .hero h1 { font-size: 26px; margin: 0 0 8px; letter-spacing: 0.3px; }
      .hero p { margin: 0; color: var(--muted); }

      /* CATEGORY NAVIGATION - Meal type filtering */
      .category-nav {
        display: flex;
        gap: 8px;
        margin: 20px 0;
        flex-wrap: wrap;
        justify-content: center;
      }
      .category-btn {
        padding: 8px 16px;
        border-radius: 20px;
        border: 1px solid var(--border);
        background: var(--chip);
        color: var(--text);
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s ease;
      }
      .category-btn:hover {
        background: var(--panel);
        border-color: var(--brand);
      }
      .category-btn.active {
        background: linear-gradient(180deg, var(--brand), var(--brand-2));
        color: #08130a;
        border-color: var(--brand);
      }

      /* CONTROLS SECTION - Ingredient input and filtering options */
      .controls {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
        margin-top: 14px;
      }

      .label-row { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
      label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 6px; }

      /* CHIP INPUT - Interactive ingredient selection with visual chips */
      .chip-input {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 8px;
        min-height: 46px;
      }
      .chip-input input {
        border: none;
        background: transparent;
        color: var(--text);
        outline: none;
        padding: 6px 6px;
        min-width: 160px;
      }

      /* TOGGLE SWITCH - Custom styled checkbox for strict/loose mode */
      .switch {
        display: inline-flex;
        align-items: center;
        gap: 10px;
      }
      .switch input { 
        appearance: none; 
        width: 40px; 
        height: 22px; 
        background: #374151; 
        border-radius: 999px; 
        position: relative; 
        outline: none; 
        cursor: pointer; 
        border: 1px solid var(--border); 
      }
      .switch input:checked { background: #22c55e; }
      .switch input::after { 
        content: ""; 
        position: absolute; 
        top: 2px; 
        left: 2px; 
        width: 18px; 
        height: 18px; 
        background: #0b1220; 
        border-radius: 50%; 
        transition: transform .2s ease; 
      }
      .switch input:checked::after { transform: translateX(18px); }

      /* COOKING METHOD FILTERS */
      .cooking-methods {
        margin-top: 12px;
      }
      .cooking-methods label {
        font-size: 12px;
        color: var(--muted);
        display: block;
        margin-bottom: 8px;
      }
      .method-chips {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      .method-chip {
        padding: 4px 10px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: var(--chip);
        color: var(--text);
        cursor: pointer;
        font-size: 12px;
        transition: all 0.2s ease;
        user-select: none;
      }
      .method-chip:hover {
        background: var(--panel);
        border-color: var(--brand);
      }
      .method-chip.active {
        background: var(--brand);
        color: #08130a;
        border-color: var(--brand);
      }

      /* BUTTON STYLES - Primary and secondary action buttons */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid var(--border);
        background: linear-gradient(180deg, var(--brand), var(--brand-2));
        color: #08130a;
        font-weight: 600;
        cursor: pointer;
        user-select: none;
      }

      .btn.secondary {
        background: var(--chip);
        color: var(--text);
      }

      /* META INFO - Results counter and status */
      .meta { display: flex; align-items: center; gap: 10px; margin: 16px 4px; color: var(--muted); font-size: 13px; }

      /* RESPONSIVE GRID - Recipe cards layout */
      .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 14px;
      }
      @media (min-width: 680px) {
        .grid { grid-template-columns: repeat(2, 1fr); }
      }
      @media (min-width: 1024px) {
        .grid { grid-template-columns: repeat(3, 1fr); }
      }

      /* RECIPE CARD - Individual recipe display */
      .card {
        background: radial-gradient(1200px 400px at -10% -20%, #1a2a47 0%, rgba(17,24,39,0) 55%), var(--panel);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 14px;
      }

      .card h3 { margin: 0 0 8px; font-size: 16px; }
      .chip-row { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 8px; }
      
      /* INGREDIENT CHIPS - Visual indicators for ingredient availability */
      .chip { 
        background: var(--chip); 
        color: var(--text); 
        border: 1px solid var(--border); 
        padding: 2px 8px; 
        border-radius: 999px; 
        font-size: 12px; 
      }
      .chip.good { background: #0f3a1f; border-color: #1f6a3b; }      /* Green: ingredient available */
      .chip.missing { background: #3a0f0f; border-color: #6a1f1f; }  /* Red: ingredient missing */
      .chip .x { margin-left: 6px; color: var(--muted); cursor: pointer; }  /* Remove button */
      .difficulty { font-weight: 700; }

      /* CONTENT SECTIONS - Recipe details styling */
      .section-title { font-size: 12px; color: var(--muted); margin: 10px 0 6px; }
      ul, ol { margin: 0; padding-left: 18px; }
      li { margin: 4px 0; }
      .empty { color: var(--muted); text-align: center; padding: 36px 8px; }

      .footer-note { color: var(--muted); font-size: 12px; text-align: center; margin-top: 20px; }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="hero">
          <h1>Smart Meal Planner</h1>
          <p>Browse all recipes by category and cooking method. Add your ingredients to see which ones you can make right now!</p>
        </div>
        
        <!-- MEAL CATEGORY NAVIGATION -->
        <div class="category-nav">
          <button class="category-btn active" data-category="all">All Meals</button>
          <button class="category-btn" data-category="breakfast">üç≥ Breakfast</button>
          <button class="category-btn" data-category="lunch">ü•™ Lunch</button>
          <button class="category-btn" data-category="dinner">üçΩÔ∏è Dinner</button>
          <button class="category-btn" data-category="desserts">üç∞ Desserts</button>
        </div>
      </header>

      <div class="controls">
        <div>
          <div class="label-row">
            <label>Ingredients you have</label>
            <div class="switch"><input id="strict" type="checkbox" checked><span>Only show recipes I can fully make</span></div>
          </div>
          <div id="chipInput" class="chip-input">
            <input id="chipText" type="text" placeholder="e.g., chicken, rice, vegetables (press Enter)" />
          </div>
        </div>
        
        <!-- COOKING METHOD FILTERS -->
        <div class="cooking-methods">
          <label>Cooking Methods:</label>
          <div class="method-chips">
            <span class="method-chip active" data-method="all">All</span>
            <span class="method-chip" data-method="microwave">‚ö° Microwave</span>
            <span class="method-chip" data-method="stove">üî• Stove</span>
            <span class="method-chip" data-method="air-fryer">üå™Ô∏è Air Fryer</span>
            <span class="method-chip" data-method="oven">üî• Oven</span>
            <span class="method-chip" data-method="no-cook">‚ùÑÔ∏è No-Cook</span>
          </div>
        </div>
        
        <div style="display:flex; gap:8px;">
          <button id="generate" class="btn" type="button">ü§ñ Generate Recipe</button>
          <button id="clear" class="btn secondary" type="button">Clear</button>
          <button id="share" class="btn secondary" type="button">Share</button>
        </div>
      </div>

      <div class="meta" id="meta" style="display:none;">
        <span id="count">0</span>
        <span id="countLabel">recipes</span>
      </div>

      <div id="grid" class="grid"></div>

      <div class="footer-note">All recipes are microwave-friendly and quick to prepare. Add ingredients to see which ones you can make!</div>
    </div>

    <script>
      // ============================================================================
      // RECIPE DATA - Comprehensive collection of microwave-friendly recipes by meal type
      // ============================================================================
      const recipes = [
        // BREAKFAST RECIPES
        { title: "Microwave Scrambled Eggs in a Mug", category: "breakfast", method: "microwave", ingredients: ["eggs", "milk", "salt", "pepper", "butter"], steps: ["Crack 2 eggs into a large mug.", "Add 2 tbsp milk, salt, and pepper.", "Whisk well.", "Microwave 30 seconds, stir, repeat until set."], difficulty: "Very Easy", time: "3 min" },
        { title: "Omelet in a Mug", category: "breakfast", method: "microwave", ingredients: ["eggs", "cheese", "veggies", "salt", "pepper"], steps: ["Crack 2 eggs into mug.", "Add cheese and chopped veggies.", "Season with salt and pepper.", "Microwave 1-2 minutes, stirring halfway."], difficulty: "Easy", time: "4 min" },
        { title: "Microwave Poached Egg on Toast", category: "breakfast", method: "microwave", ingredients: ["egg", "bread", "vinegar", "salt"], steps: ["Fill mug with water and splash of vinegar.", "Crack egg into water.", "Microwave 1 minute.", "Toast bread and top with poached egg."], difficulty: "Medium", time: "5 min" },
        { title: "Instant Oatmeal with Peanut Butter & Banana", category: "breakfast", method: "microwave", ingredients: ["instant oats", "peanut butter", "banana", "milk"], steps: ["Cook instant oats in microwave.", "Stir in peanut butter.", "Top with sliced banana.", "Add milk if desired."], difficulty: "Very Easy", time: "3 min" },
        { title: "Mug Pancake", category: "breakfast", method: "microwave", ingredients: ["flour", "milk", "egg", "sugar", "baking powder"], steps: ["Mix 4 tbsp flour, 1 tbsp sugar, 1/4 tsp baking powder.", "Add 3 tbsp milk and 1 egg.", "Mix until smooth.", "Microwave 1-2 minutes until fluffy."], difficulty: "Easy", time: "4 min" },
        { title: "Microwave French Toast Mug", category: "breakfast", method: "microwave", ingredients: ["bread", "egg", "milk", "cinnamon", "vanilla"], steps: ["Cut bread into cubes.", "Whisk egg, milk, cinnamon, vanilla.", "Pour over bread cubes.", "Microwave 1-2 minutes until set."], difficulty: "Easy", time: "4 min" },
        { title: "Cinnamon Roll Mug Cake", category: "breakfast", method: "microwave", ingredients: ["canned cinnamon rolls", "flour", "milk"], steps: ["Mix 6 tbsp flour, 2 tbsp sugar, 3 tbsp milk.", "Roll into strip, sprinkle cinnamon sugar.", "Place in mug, microwave 1-2 minutes.", "Top with icing from can."], difficulty: "Medium", time: "5 min" },
        { title: "Breakfast Burrito", category: "breakfast", method: "microwave", ingredients: ["tortilla", "egg", "cheese", "salsa"], steps: ["Scramble egg in mug.", "Warm tortilla 15 seconds.", "Fill with egg, cheese, salsa.", "Roll up and enjoy."], difficulty: "Easy", time: "5 min" },
        { title: "Microwave Quesadilla", category: "breakfast", method: "microwave", ingredients: ["tortilla", "cheese", "egg"], steps: ["Scramble egg in mug.", "Place tortilla on plate.", "Add cheese and egg.", "Fold and microwave 1 minute."], difficulty: "Very Easy", time: "3 min" },
        { title: "Microwave English Muffin Pizza", category: "breakfast", method: "microwave", ingredients: ["english muffin", "egg", "cheese", "salt", "pepper"], steps: ["Split and toast english muffin.", "Scramble egg with salt and pepper.", "Top muffin with egg and cheese.", "Microwave 30 seconds until cheese melts."], difficulty: "Easy", time: "4 min" },
        
        // LUNCH RECIPES
        { title: "Microwave Mac & Cheese in a Mug", category: "lunch", method: "microwave", ingredients: ["pasta", "cheese", "milk", "butter"], steps: ["Add 1/2 cup pasta and water to mug.", "Microwave 3-4 minutes.", "Drain and add cheese, milk, butter.", "Microwave 30 seconds until creamy."], difficulty: "Easy", time: "6 min" },
        { title: "Microwave Ramen with Egg & Veggies", category: "lunch", method: "microwave", ingredients: ["ramen", "egg", "vegetables", "soy sauce"], steps: ["Cook ramen according to package.", "Add vegetables and cook 1 more minute.", "Crack egg into hot broth.", "Let sit 1 minute, stir gently."], difficulty: "Easy", time: "5 min" },
        { title: "Microwave Quesadilla", category: "lunch", method: "microwave", ingredients: ["tortilla", "cheese", "salsa"], steps: ["Place tortilla on plate.", "Sprinkle cheese on half.", "Fold over and microwave 1 minute.", "Serve with salsa."], difficulty: "Very Easy", time: "2 min" },
        { title: "Microwave Hot Pocket Dupe", category: "lunch", method: "microwave", ingredients: ["tortilla", "ham", "cheese"], steps: ["Place tortilla on plate.", "Add ham and cheese.", "Fold into pocket shape.", "Microwave 1-2 minutes until hot."], difficulty: "Very Easy", time: "3 min" },
        { title: "Microwave Nachos", category: "lunch", method: "microwave", ingredients: ["tortilla chips", "cheese", "salsa"], steps: ["Spread chips on plate.", "Sprinkle cheese over top.", "Microwave 45-60 seconds.", "Top with salsa."], difficulty: "Very Easy", time: "2 min" },
        { title: "Microwave Chili", category: "lunch", method: "microwave", ingredients: ["canned chili", "cheese", "onions"], steps: ["Empty chili into bowl.", "Microwave 2-3 minutes.", "Top with cheese and onions.", "Serve hot."], difficulty: "Very Easy", time: "4 min" },
        { title: "Microwave Grilled Cheese", category: "lunch", method: "microwave", ingredients: ["bread", "cheese", "butter"], steps: ["Butter bread slices.", "Add cheese between slices.", "Microwave 1-2 minutes.", "Flip and microwave 30 seconds more."], difficulty: "Very Easy", time: "3 min" },
        { title: "Microwave Tomato Soup", category: "lunch", method: "microwave", ingredients: ["canned tomato soup", "milk", "croutons"], steps: ["Mix soup with milk in bowl.", "Microwave 2-3 minutes.", "Stir and top with croutons.", "Serve hot."], difficulty: "Very Easy", time: "4 min" },
        { title: "Microwave Baked Potato", category: "lunch", method: "microwave", ingredients: ["potato", "cheese", "butter", "salt"], steps: ["Wash potato and poke holes.", "Microwave 5-6 minutes.", "Cut open and add butter, cheese.", "Microwave 30 seconds more."], difficulty: "Easy", time: "7 min" },
        { title: "Microwave Sweet Potato", category: "lunch", method: "microwave", ingredients: ["sweet potato", "cinnamon", "butter"], steps: ["Wash sweet potato and poke holes.", "Microwave 6-8 minutes.", "Cut open and add butter, cinnamon.", "Serve warm."], difficulty: "Easy", time: "8 min" },
        
        // DINNER RECIPES
        { title: "Microwave Mug Pizza", category: "dinner", method: "microwave", ingredients: ["flour", "baking powder", "milk", "pizza sauce", "cheese"], steps: ["Mix 4 tbsp flour, 1/4 tsp baking powder, 3 tbsp milk.", "Spread pizza sauce on top.", "Add cheese and toppings.", "Microwave 1-2 minutes."], difficulty: "Medium", time: "5 min" },
        { title: "Microwave Teriyaki Rice Bowl", category: "dinner", method: "microwave", ingredients: ["rice", "chicken", "teriyaki sauce", "vegetables"], steps: ["Cook rice in microwave.", "Add cooked chicken and vegetables.", "Drizzle with teriyaki sauce.", "Microwave 1 minute to heat through."], difficulty: "Easy", time: "8 min" },
        { title: "Microwave Chicken Quesadilla", category: "dinner", method: "microwave", ingredients: ["tortilla", "chicken", "cheese", "salsa"], steps: ["Shred cooked chicken.", "Place on tortilla with cheese.", "Fold and microwave 1-2 minutes.", "Serve with salsa."], difficulty: "Easy", time: "4 min" },
        { title: "Microwave Mac & Cheese Upgrade", category: "dinner", method: "microwave", ingredients: ["pasta", "cheese", "milk", "bacon", "breadcrumbs"], steps: ["Cook pasta and cheese sauce.", "Add crumbled bacon.", "Top with breadcrumbs.", "Microwave 1 minute to crisp topping."], difficulty: "Easy", time: "7 min" },
        { title: "Microwave Nacho Supreme", category: "dinner", method: "microwave", ingredients: ["tortilla chips", "cheese", "ground beef", "jalape√±os", "sour cream"], steps: ["Cook ground beef in microwave.", "Layer chips, beef, cheese, jalape√±os.", "Microwave 1-2 minutes.", "Top with sour cream."], difficulty: "Easy", time: "6 min" },
        { title: "Microwave Enchilada Mug", category: "dinner", method: "microwave", ingredients: ["tortilla", "chicken", "enchilada sauce", "cheese"], steps: ["Shred cooked chicken.", "Mix with enchilada sauce.", "Layer in mug with tortilla pieces.", "Top with cheese and microwave 2 minutes."], difficulty: "Medium", time: "6 min" },
        { title: "Microwave Chili Mac", category: "dinner", method: "microwave", ingredients: ["pasta", "chili", "cheese", "onions"], steps: ["Cook pasta in microwave.", "Mix with canned chili.", "Add cheese and onions.", "Microwave 1 minute to melt cheese."], difficulty: "Easy", time: "7 min" },
        { title: "Microwave Hot Dog in Bun", category: "dinner", method: "microwave", ingredients: ["hot dog", "bun", "mustard", "ketchup"], steps: ["Place hot dog in bun.", "Microwave 1 minute.", "Add condiments.", "Serve immediately."], difficulty: "Very Easy", time: "2 min" },
        { title: "Microwave Sloppy Joe", category: "dinner", method: "microwave", ingredients: ["ground beef", "sloppy joe sauce", "bun"], steps: ["Cook ground beef in microwave.", "Mix with sauce.", "Heat bun 15 seconds.", "Fill bun with mixture."], difficulty: "Easy", time: "5 min" },
        { title: "Microwave Burrito Bowl", category: "dinner", method: "microwave", ingredients: ["rice", "beans", "cheese", "salsa", "sour cream"], steps: ["Cook rice in microwave.", "Heat beans separately.", "Layer rice, beans, cheese.", "Top with salsa and sour cream."], difficulty: "Easy", time: "8 min" },
        
        // DESSERT RECIPES
        { title: "Microwave Brownie in a Mug", category: "desserts", method: "microwave", ingredients: ["flour", "cocoa", "sugar", "oil", "water"], steps: ["Mix 4 tbsp flour, 4 tbsp sugar, 2 tbsp cocoa.", "Add 2 tbsp oil and 2 tbsp water.", "Mix until smooth.", "Microwave 1-2 minutes."], difficulty: "Easy", time: "3 min" },
        { title: "Microwave Chocolate Chip Cookie", category: "desserts", method: "microwave", ingredients: ["flour", "sugar", "butter", "chocolate chips"], steps: ["Mix 4 tbsp flour, 2 tbsp sugar, 1 tbsp butter.", "Stir in 2 tbsp chocolate chips.", "Microwave 1 minute.", "Let cool slightly."], difficulty: "Easy", time: "3 min" },
        { title: "Microwave S'mores", category: "desserts", method: "microwave", ingredients: ["graham crackers", "chocolate", "marshmallow"], steps: ["Layer graham cracker, chocolate, marshmallow.", "Microwave 20-30 seconds.", "Top with another graham cracker.", "Enjoy while warm."], difficulty: "Very Easy", time: "1 min" },
        { title: "Microwave Fudge", category: "desserts", method: "microwave", ingredients: ["chocolate chips", "sweetened condensed milk", "vanilla"], steps: ["Mix chocolate chips and condensed milk.", "Microwave 1 minute, stir.", "Add vanilla and stir.", "Pour into dish and chill."], difficulty: "Easy", time: "5 min" },
        { title: "Microwave Rice Krispie Treats", category: "desserts", method: "microwave", ingredients: ["marshmallows", "butter", "rice krispies"], steps: ["Microwave butter and marshmallows 1 minute.", "Stir until smooth.", "Mix in rice krispies.", "Press into dish and cool."], difficulty: "Easy", time: "5 min" },
        { title: "Microwave Mug Cinnamon Roll", category: "desserts", method: "microwave", ingredients: ["flour", "sugar", "milk", "cinnamon", "butter"], steps: ["Mix 6 tbsp flour, 2 tbsp sugar, 3 tbsp milk.", "Roll into strip, sprinkle cinnamon sugar.", "Roll up and place in mug.", "Microwave 1-2 minutes."], difficulty: "Medium", time: "5 min" },
        { title: "Microwave Cheesecake in a Mug", category: "desserts", method: "microwave", ingredients: ["cream cheese", "sugar", "egg", "vanilla"], steps: ["Mix 4 tbsp cream cheese, 2 tbsp sugar.", "Add 1 egg yolk and vanilla.", "Microwave 1-2 minutes.", "Chill if desired."], difficulty: "Medium", time: "4 min" },
        { title: "Microwave Peanut Butter Mug Cake", category: "desserts", method: "microwave", ingredients: ["flour", "sugar", "peanut butter", "milk", "oil"], steps: ["Mix 4 tbsp flour, 2 tbsp sugar.", "Add 2 tbsp peanut butter, 3 tbsp milk, 1 tbsp oil.", "Mix until smooth.", "Microwave 1-2 minutes."], difficulty: "Easy", time: "3 min" },
        { title: "Microwave Nutella Lava Cake", category: "desserts", method: "microwave", ingredients: ["flour", "sugar", "cocoa", "nutella", "milk"], steps: ["Mix dry ingredients.", "Add milk and 2 tbsp nutella.", "Mix until smooth.", "Microwave 1 minute."], difficulty: "Easy", time: "3 min" },
        { title: "Microwave Marshmallow Mug Cake", category: "desserts", method: "microwave", ingredients: ["flour", "sugar", "milk", "marshmallows"], steps: ["Mix 4 tbsp flour, 2 tbsp sugar, 3 tbsp milk.", "Add 3-4 marshmallows.", "Microwave 1-2 minutes.", "Top with more marshmallows."], difficulty: "Easy", time: "3 min" }
      ];

      // ============================================================================
      // APPLICATION STATE - Manages user selections and URL synchronization
      // ============================================================================
      const params = new URLSearchParams(location.search);
      const state = {
        have: (params.get('have') || '').split(',').map(s => s.trim()).filter(Boolean),  // User's available ingredients
        strict: params.get('strict') !== '0',  // Strict mode: only show recipes user can fully make
        category: params.get('category') || 'all',  // Selected meal category
        method: params.get('method') || 'all',  // Selected cooking method
        generatedRecipes: loadGeneratedRecipes()  // AI-generated recipes stored locally
      };

      // ============================================================================
      // DOM ELEMENTS - Cached references to HTML elements for performance
      // ============================================================================
      const els = {
        grid: document.getElementById('grid'),           // Recipe cards container
        meta: document.getElementById('meta'),           // Results counter container
        count: document.getElementById('count'),         // Number of results
        countLabel: document.getElementById('countLabel'), // "recipes" or "matches" text
        generate: document.getElementById('generate'),   // AI generate button
        clear: document.getElementById('clear'),         // Clear all button
        share: document.getElementById('share'),         // Share link button
        chipInput: document.getElementById('chipInput'), // Ingredient chips container
        chipText: document.getElementById('chipText'),   // Text input for new ingredients
        strict: document.getElementById('strict'),       // Strict mode toggle
        categoryBtns: document.querySelectorAll('.category-btn'), // Category filter buttons
        methodChips: document.querySelectorAll('.method-chip')     // Cooking method filter chips
      };

      // ============================================================================
      // INITIALIZATION FUNCTIONS - Set up initial state from URL parameters
      // ============================================================================
      function setInitialInputs() {
        els.strict.checked = !!state.strict;
        renderChips();
        
        // Set active category button
        els.categoryBtns.forEach(btn => {
          btn.classList.toggle('active', btn.dataset.category === state.category);
        });
        
        // Set active method chip
        els.methodChips.forEach(chip => {
          chip.classList.toggle('active', chip.dataset.method === state.method);
        });
      }

      // ============================================================================
      // URL MANAGEMENT - Synchronize application state with browser URL for sharing
      // ============================================================================
      function updateURL() {
        const params = new URLSearchParams();
        if (state.have.length) params.set('have', state.have.join(','));
        params.set('strict', state.strict ? '1' : '0');
        if (state.category !== 'all') params.set('category', state.category);
        if (state.method !== 'all') params.set('method', state.method);
        const qs = params.toString();
        history.replaceState(null, '', qs ? `?${qs}` : location.pathname);
      }

      // ============================================================================
      // UTILITY FUNCTIONS - Helper functions for data processing and comparison
      // ============================================================================
      
      /**
       * Normalize string for consistent comparison (lowercase, trimmed)
       * @param {string} str - Input string to normalize
       * @returns {string} Normalized string
       */
      function normalize(str) {
        return (str || '').toLowerCase().trim();
      }

      /**
       * Check if all needles exist in haystack list (case-insensitive)
       * @param {Array} haystackList - List to search in
       * @param {Array} needles - Items to find
       * @returns {boolean} True if all needles found
       */
      function includesAll(haystackList, needles) {
        const set = new Set(haystackList.map(normalize));
        return needles.every(n => set.has(normalize(n)));
      }

      /**
       * Count how many items from bList exist in aList
       * @param {Array} aList - First list
       * @param {Array} bList - Second list
       * @returns {number} Count of matching items
       */
      function intersectionCount(aList, bList) {
        const a = new Set(aList.map(normalize));
        let c = 0;
        for (const b of bList) if (a.has(normalize(b))) c++;
        return c;
      }

      // ============================================================================
      // AI RECIPE GENERATION - Generate custom recipes based on available ingredients
      // ============================================================================
      
      /**
       * Generate a custom microwave recipe based on available ingredients
       * @param {Array} ingredients - List of available ingredients
       * @returns {Object} Generated recipe object
       */
      function generateAICRecipe(ingredients) {
        const recipeTemplates = [
          {
            name: "Microwave {main} Bowl",
            base: ["rice", "pasta", "quinoa", "oats"],
            patterns: [
              { main: "Rice", steps: ["Add 1 cup rice and 1.5 cups water to a bowl.", "Microwave 5 minutes, let stand 2 minutes.", "Top with {toppings} and serve hot."] },
              { main: "Pasta", steps: ["Add 1 cup pasta and enough water to cover in a bowl.", "Microwave 4-5 minutes until tender.", "Drain and mix with {toppings}."] }
            ]
          },
          {
            name: "Microwave {main} Wrap",
            base: ["tortilla", "bread"],
            patterns: [
              { main: "Quesadilla", steps: ["Place tortilla on a plate.", "Add {fillings} to one half.", "Fold over and microwave 1-2 minutes until melted."] },
              { main: "Breakfast", steps: ["Scramble {eggs} in a mug for 1 minute.", "Warm tortilla 15 seconds.", "Fill with scrambled eggs and {toppings}."] }
            ]
          },
          {
            name: "Microwave {main} Mug Cake",
            base: ["flour", "sugar", "cocoa", "chocolate"],
            patterns: [
              { main: "Chocolate", steps: ["Mix 4 tbsp flour, 3 tbsp sugar, 2 tbsp cocoa in a mug.", "Add 3 tbsp milk and 2 tbsp oil.", "Microwave 1-2 minutes until set."] },
              { main: "Vanilla", steps: ["Mix 4 tbsp flour, 2 tbsp sugar, 1/4 tsp baking powder in a mug.", "Add 3 tbsp milk and 1 tbsp oil.", "Microwave 1-2 minutes until fluffy."] }
            ]
          },
          {
            name: "Microwave {main} Scramble",
            base: ["eggs", "cheese"],
            patterns: [
              { main: "Cheesy", steps: ["Crack 2 eggs into a mug, whisk with 2 tbsp milk.", "Add {cheese} and microwave 30 seconds.", "Stir and microwave another 30-60 seconds."] }
            ]
          }
        ];

        // Find a suitable template based on ingredients
        const suitableTemplates = recipeTemplates.filter(template => 
          template.base.some(base => ingredients.some(ing => normalize(ing).includes(normalize(base))))
        );

        if (suitableTemplates.length === 0) {
          // Fallback: create a simple microwave dish
          return {
            title: "Microwave Mixed Bowl",
            ingredients: ingredients,
            steps: [
              "Combine all ingredients in a microwave-safe bowl.",
              "Add 2-3 tablespoons of water or oil as needed.",
              "Microwave for 2-3 minutes, stirring halfway through.",
              "Let stand 1 minute before serving."
            ],
            difficulty: "Easy",
            isGenerated: true
          };
        }

        const template = suitableTemplates[0];
        const pattern = template.patterns[Math.floor(Math.random() * template.patterns.length)];
        
        // Generate recipe name
        const mainIngredient = ingredients.find(ing => 
          template.base.some(base => normalize(ing).includes(normalize(base)))
        ) || "Mixed";
        
        const recipeName = template.name.replace("{main}", mainIngredient.charAt(0).toUpperCase() + mainIngredient.slice(1));
        
        // Generate steps with ingredient substitutions
        const steps = pattern.steps.map(step => {
          let modifiedStep = step;
          if (step.includes("{toppings}")) {
            const toppings = ingredients.filter(ing => 
              !template.base.some(base => normalize(ing).includes(normalize(base)))
            ).slice(0, 3).join(", ");
            modifiedStep = modifiedStep.replace("{toppings}", toppings || "your favorite seasonings");
          }
          if (step.includes("{fillings}")) {
            const fillings = ingredients.slice(0, 3).join(" and ");
            modifiedStep = modifiedStep.replace("{fillings}", fillings);
          }
          if (step.includes("{cheese}")) {
            const cheese = ingredients.find(ing => normalize(ing).includes("cheese")) || "shredded cheese";
            modifiedStep = modifiedStep.replace("{cheese}", cheese);
          }
          if (step.includes("{eggs}")) {
            modifiedStep = modifiedStep.replace("{eggs}", "2 eggs");
          }
          return modifiedStep;
        });

        return {
          title: recipeName,
          category: state.category !== 'all' ? state.category : ['breakfast', 'lunch', 'dinner', 'desserts'][Math.floor(Math.random() * 4)],
          method: state.method !== 'all' ? state.method : ['microwave', 'stove', 'air-fryer', 'oven', 'no-cook'][Math.floor(Math.random() * 5)],
          ingredients: ingredients,
          steps: steps,
          difficulty: ["Very Easy", "Easy", "Medium"][Math.floor(Math.random() * 3)],
          time: ["5 min", "10 min", "15 min", "20 min"][Math.floor(Math.random() * 4)],
          isGenerated: true
        };
      }

      /**
       * Load generated recipes from localStorage
       * @returns {Array} Array of generated recipes
       */
      function loadGeneratedRecipes() {
        try {
          const stored = localStorage.getItem('generatedRecipes');
          return stored ? JSON.parse(stored) : [];
        } catch (e) {
          return [];
        }
      }

      /**
       * Save generated recipes to localStorage
       * @param {Array} recipes - Array of generated recipes to save
       */
      function saveGeneratedRecipes(recipes) {
        try {
          localStorage.setItem('generatedRecipes', JSON.stringify(recipes));
        } catch (e) {
          console.warn('Could not save generated recipes:', e);
        }
      }

      // ============================================================================
      // RECIPE FILTERING - Core logic for finding matching recipes based on ingredients
      // ============================================================================
      
      /**
       * Filter recipes based on user's available ingredients, category, cooking method, and strict mode
       * @param {Array} all - All available recipes
       * @returns {Array} Filtered and sorted recipes (all visible, makeable ones on top)
       */
      function filterRecipes(all) {
        const have = state.have.map(normalize);
        
        // Combine original recipes with generated ones
        const allRecipes = [...all, ...state.generatedRecipes];
        
        // Filter by category first
        let filtered = allRecipes;
        if (state.category !== 'all') {
          filtered = filtered.filter(r => r.category === state.category);
        }
        
        // Filter by cooking method
        if (state.method !== 'all') {
          filtered = filtered.filter(r => r.method === state.method);
        }
        
        // Calculate match statistics for each recipe
        const list = filtered.map(r => {
          const needed = r.ingredients.map(normalize);
          const hits = intersectionCount(have, needed);           // How many ingredients user has
          const missing = needed.filter(x => !have.includes(x)); // What's still needed
          const canMake = hits === needed.length;                // Can make complete recipe
          const partialMatch = hits > 0;                         // Has some ingredients
          return { ...r, _hits: hits, _missing: missing, _canMake: canMake, _partialMatch: partialMatch };
        });
        
        // Sort results: makeable recipes first, then partial matches, then everything else
        return list.sort((a, b) => {
          // First priority: recipes you can fully make
          if (a._canMake && !b._canMake) return -1;
          if (!a._canMake && b._canMake) return 1;
          
          // Second priority: partial matches (if not in strict mode)
          if (!state.strict) {
            if (a._partialMatch && !b._partialMatch) return -1;
            if (!a._partialMatch && b._partialMatch) return 1;
            
            // Within partial matches, sort by match count
            if (a._partialMatch && b._partialMatch) {
              if (b._hits !== a._hits) return b._hits - a._hits;
              if (a._missing.length !== b._missing.length) return a._missing.length - b._missing.length;
            }
          }
          
          // Final sort: alphabetical by title
          return a.title.localeCompare(b.title);
        });
      }

      // ============================================================================
      // DOM UTILITIES - Helper functions for creating and manipulating DOM elements
      // ============================================================================
      
      /**
       * Create HTML element with attributes and children (lightweight alternative to JSX)
       * @param {string} tag - HTML tag name
       * @param {Object} attrs - Element attributes
       * @param {...any} children - Child elements or text content
       * @returns {HTMLElement} Created element
       */
      function h(tag, attrs = {}, ...children) {
        const el = document.createElement(tag);
        for (const [k, v] of Object.entries(attrs)) {
          if (k === 'class') el.className = v;
          else if (k === 'html') el.innerHTML = v;
          else el.setAttribute(k, v);
        }
        for (const c of children) {
          if (Array.isArray(c)) c.forEach(x => x && el.appendChild(x));
          else if (c instanceof Node) el.appendChild(c);
          else if (c != null) el.appendChild(document.createTextNode(String(c)));
        }
        return el;
      }

      // ============================================================================
      // RENDERING FUNCTIONS - Display recipe cards and manage UI state
      // ============================================================================
      
      /**
       * Render recipe cards in the grid based on filtered results
       * @param {Array} list - Filtered recipe list to display
       */
      function renderCards(list) {
        els.grid.innerHTML = '';
        
        // Always show results counter (since we show all recipes now)
        els.meta.style.display = '';
        els.count.textContent = list.length;
        
        // Update count label based on what's being shown
        if (state.have.length === 0) {
          els.countLabel.textContent = list.length === 1 ? 'recipe available' : 'recipes available';
        } else {
          const makeableCount = list.filter(r => r._canMake).length;
          const partialCount = list.filter(r => r._partialMatch && !r._canMake).length;
          
          if (makeableCount > 0) {
            els.countLabel.textContent = `${makeableCount} you can make ‚Ä¢ ${list.length} total`;
          } else if (partialCount > 0) {
            els.countLabel.textContent = `${partialCount} partial matches ‚Ä¢ ${list.length} total`;
          } else {
            els.countLabel.textContent = `${list.length} recipes (add ingredients to see matches)`;
          }
        }

        // Show empty state only if no recipes match category/method filters
        if (list.length === 0) {
          els.grid.appendChild(h('div', { class: 'empty' }, 
            'No recipes found for the selected category and cooking method. Try changing your filters.'));
          return;
        }

        // Render each recipe card
        for (const r of list) {
          const haveSet = new Set(state.have.map(normalize));
          
          // Create ingredient chips with availability indicators
          const ingChips = h(
            'div',
            { class: 'chip-row' },
            ...r.ingredients.map(i => h('span', { 
              class: `chip ${haveSet.has(normalize(i)) ? 'good' : 'missing'}` 
            }, i))
          );

          // Create ordered list of cooking steps
          const stepsList = h('ol', {}, ...r.steps.map(s => h('li', {}, s)));

          // Build complete recipe card
          const card = h(
            'div',
            { class: 'card' },
            h('h3', {}, r.title),
            h('div', { class: 'chip-row' },
              h('span', { class: 'chip difficulty' }, r.difficulty),
              h('span', { class: 'chip' }, r.time || 'Quick'),
              h('span', { class: 'chip' }, r.method || 'microwave'),
              // Show match stats for all recipes
              state.have.length > 0 && h('span', { class: 'chip' }, 
                r._canMake ? '‚úÖ Can make' : 
                r._partialMatch ? `${r._hits} have ‚Ä¢ ${r._missing.length} missing` : 
                '‚ùå Need ingredients')
            ),
            h('div', { class: 'section-title' }, 'Ingredients'),
            ingChips,
            h('div', { class: 'section-title' }, 'Steps'),
            stepsList
          );

          els.grid.appendChild(card);
        }
      }

      /**
       * Render ingredient chips in the input area with remove functionality
       */
      function renderChips() {
        // Remove existing chips (keep the input)
        Array.from(els.chipInput.querySelectorAll('span[data-chip]')).forEach(el => el.remove());
        
        // Create chips for each ingredient
        for (const item of state.have) {
          const chip = h('span', { class: 'chip', 'data-chip': item }, 
            item, 
            h('span', { class: 'x', title: 'Remove' }, '√ó')
          );
          
          // Add click handler to remove ingredient
          chip.querySelector('.x').addEventListener('click', () => {
            state.have = state.have.filter(x => x !== item);
            renderChips();
            applyFilters();
          });
          
          els.chipInput.insertBefore(chip, els.chipText);
        }
      }

      /**
       * Add ingredients from text input (supports comma or newline separation)
       * @param {string} raw - Raw input text
       */
      function addFromText(raw) {
        const items = raw.split(/[\n,]/g).map(s => normalize(s)).filter(Boolean);
        for (const it of items) {
          if (!state.have.includes(it)) state.have.push(it);
        }
        els.chipText.value = '';
        renderChips();
        applyFilters();
      }

      // ============================================================================
      // MAIN APPLICATION LOGIC - Orchestrate filtering and rendering
      // ============================================================================
      
      /**
       * Apply current filters and update the display
       */
      function applyFilters() {
        const list = filterRecipes(recipes);
        renderCards(list);
        updateURL();
      }

      // ============================================================================
      // EVENT HANDLERS - User interaction and input management
      // ============================================================================
      
      /**
       * Set up all event listeners for user interactions
       */
      function setupEvents() {
        // Strict mode toggle
        els.strict.addEventListener('change', () => {
          state.strict = els.strict.checked;
          applyFilters();
        });

        // Category filter buttons
        els.categoryBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            els.categoryBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            state.category = btn.dataset.category;
            applyFilters();
          });
        });

        // Cooking method filter chips
        els.methodChips.forEach(chip => {
          chip.addEventListener('click', () => {
            els.methodChips.forEach(c => c.classList.remove('active'));
            chip.classList.add('active');
            state.method = chip.dataset.method;
            applyFilters();
          });
        });

        // Ingredient input handling
        els.chipText.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ',') {
            e.preventDefault();
            addFromText(els.chipText.value);
          } else if (e.key === 'Backspace' && els.chipText.value === '' && state.have.length) {
            // Remove last ingredient on backspace when input is empty
            state.have.pop();
            renderChips();
            applyFilters();
          }
        });
        
        // Add ingredients on blur (when user clicks away)
        els.chipText.addEventListener('blur', () => {
          if (els.chipText.value.trim()) addFromText(els.chipText.value);
        });
        
        // Handle pasted ingredient lists
        els.chipText.addEventListener('paste', (e) => {
          const text = (e.clipboardData || window.clipboardData).getData('text');
          if (text && /[,\n]/.test(text)) {
            e.preventDefault();
            addFromText(text);
          }
        });

        // Clear all ingredients and reset to strict mode
        els.clear.addEventListener('click', () => {
          state.have = [];
          state.strict = true;
          state.category = 'all';
          state.method = 'all';
          setInitialInputs();
          applyFilters();
        });

        // Share current state as URL
        els.share.addEventListener('click', async () => {
          const url = location.href;
          try {
            await navigator.clipboard.writeText(url);
            const original = els.share.textContent;
            els.share.textContent = 'Copied!';
            setTimeout(() => (els.share.textContent = original), 1200);
          } catch (e) {
            alert('Link: ' + url);
          }
        });
      }

      // ============================================================================
      // APPLICATION INITIALIZATION - Start the app when page loads
      // ============================================================================
      setInitialInputs();  // Set up UI from URL parameters
      setupEvents();       // Attach event listeners
      applyFilters();      // Show initial results
    </script>
  </body>
  </html>


